<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">

  <title>Weather Mood Tracks</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.6/flatly/bootstrap.min.css">
</head>

<body>
  <!-- CSS Icons -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

  <!-- Style to fix the issue of text extending past panel length -->
  <style>
    .panel-body a {
      word-break: break-all;
    }
  </style>
  </head>

  <body>

    <!-- Main Search -->
    <div class="container">

      <!-- Jumbotron for Title -->
      <div class="jumbotron" style="background-color: #20315A ; color: white;">
        <h1 class="text-center"><strong><i class="fa fa-music note-o"></i> Weather/Mood Tracks</strong></h1>
      </div>

      <!-- Structure section -->
      <div class="row">
        <div class="col-sm-12">
          <br>
          <!-- First panel is for handling parameters -->
          <div class="panel panel-primary">
            <div class="panel-heading">
              <h3 class="panel-title"><strong><i class="fa  fa-list-alt"></i> Location Data</strong></h3>
            </div>
            <div class="panel-body">

              <!-- Here we create an HTML Form for handling the inputs-->
              <form role="form">

                <!-- Here we create the text box for capturing the location data-->
                <div class="form-group">
                  <div class="card">
                    <div class="card-header">
                      City Name
                    </div>
                    <div class="card-body">
                      <h5 class="card-title">Zip Code</h5>
                      <p class="card-text">Todayâ€™s Forecast</p>
                      <p class="card-text">Temperture:</p>
                      <p class="card-text">Humidity:</p>
                      <p class="card-text">Wind Speed:</p>
                      <p class="card-text">UV Index:</p>
                      <a href="#" class="btn btn-primary">Find Songs</a>
                    </div>
                  </div>

                  <!-- Here we have the cards used for the results -->
                  <div class="panel panel-primary">
                    <div class="panel-heading">
                      <h3 class="panel-title"><strong><i class="fa  fa-music note"></i> Suggested Tracks</strong></h3>
                    </div>

                    <!--inserting card group here. -->
                    <div id="songsContainer" class="container">
                      <div id="songsRow1" class="row row-cols-auto">

                      </div>
                    </div>
                  </div>
                </div>
                <!-- Card and Row group for saved songs -->
                <div class="panel panel-primary">
                  <div class="panel-heading">
                    <h3 class="panel-title"><strong><i class="fa  fa-music note"></i> Saved Tracks</strong></h3>
                  </div>

                  <div id="songsContainer" class="container">
                    <div id="songsRowSaved" class="row row-cols-auto">

                    </div>
                  </div>
                </div>
            </div>
            </form>
          </div>
        </div>
      </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript">
      function buildSavedSongs(){
        $("#songsRowSaved").empty();
        let storeCount = 0;
        const songsRow = $("#songsRowSaved");
        while(localStorage.getItem(storeCount)  != null){
          const JSobject = localStorage.getItem(storeCount);
          const songDict = JSON.parse(JSobject);
          // Creating Song Card for new song
          const songCol = $("<div>");
            songCol.addClass("col");
            const songCard = $("<div>");
            songCard.addClass("card-body");
            // getting and setting song title in card
            const songTitle = $("<h5>");
            songTitle.addClass("card-title");
            const songTLink = $("<a>");
            songTLink.text(songDict["title"]);
            songTLink.innherHTML(songDict["url"]);
            // getting and setting song artist with link
            const songArtist = $("<p>");
            songArtist.addClass("card-text");
            const songALink = $("<a>");
            songALink.text(testArrayArtists[songCounter]);
            songALink.attr("href", "youtube.com");
            //creating Save button
            const saveButton = $("<button>");
            saveButton.addClass("btn btn-default saveBtn");
            saveButton.text("Save");
            //appending all items as needed
            songTitle.append(songTLink);
            songArtist.append(songALink);
            songCard.append(songTitle);
            songCard.append(songArtist);
            songCard.append(saveButton);
            songsRow.append(songCol);
            songsRow.append(songCard);

        }
      }
      function buildSongRows(weatherWord) {
        const testArraySongs = ["Hurt", "Paparazzi", "Fortunate Son", "Chandelier", "Sugar", "Hurt", "Paparazzi", "Fortunate Son", "Chandelier", "Sugar"];
        const testArrayArtists = ["Johnny Cash", "Lady Gaga", "Creedence Clearwater Revival", "Sia", "System of a Down", "Jenny Bucks", "Lady Gaga", "Creedence Clearwater Revival", "Sia", "System of a Down"];
        // function global counter to count through ten songs
        let songCounter = 0;
        // For loop to build two rows of songs
        for (let i = 0; i < 2; i++) {
          //Making new row 
          const songsRow = $("<div>");
          songsRow.addClass("row row-cols-auto");
          for (let i = 0; i < 5; i++) {
            // Creating Song Card for new song
            const songCol = $("<div>");
            songCol.addClass("col");
            const songCard = $("<div>");
            songCard.addClass("card-body");
            // getting and setting song title in card
            const songTitle = $("<h5>");
            songTitle.addClass("card-title");
            const songTLink = $("<a>");
            songTLink.text(testArraySongs[songCounter]);
            songTLink.attr("href", "youtube.com");
            // getting and setting song artist with link
            const songArtist = $("<p>");
            songArtist.addClass("card-text");
            const songALink = $("<a>");
            songALink.text(testArrayArtists[songCounter]);
            songALink.attr("href", "youtube.com");
            //creating Save button
            const saveButton = $("<button>");
            saveButton.addClass("btn btn-default saveBtn");
            saveButton.text("Save");
            //appending all items as needed
            songTitle.append(songTLink);
            songArtist.append(songALink);
            songCard.append(songTitle);
            songCard.append(songArtist);
            songCard.append(saveButton);
            songsRow.append(songCol);
            songsRow.append(songCard);
            songCounter++;
          }
          $("#songsContainer").append(songsRow);
        }

      }
      $(document).ready(function () {
        let tempWord = "Cloudy";
        buildSongRows(tempWord);


      })

      $(document).on("click", ".saveBtn", function(){
        event.preventDefault();
        let savePosition = 0;
        if( localStorage.getItem("lastUsed") === null){
          localStorage.setItem("lastUsed", savePosition);
        }
        else if(localStorage.getItem("lastUsed") >=4 ){
          savePosition = 0;
          localStorage.setItem("lastUsed", savePosition);
        }
        else{
          savePosition = localStorage.getItem("lastUsed");
          savePosition++
          localStorage.setItem("lastUsed", savePosition);
        }
        const siblings = $(this).siblings();
          const sTitle = siblings[0].innerText;
          const sUrl = siblings[0].innerHTML;
          const sArtist = siblings[1].innerText;
          const songDict = {
            "title": sTitle,
            "url": sUrl,
            "artist": sArtist
          }
          const dictString = JSON.stringify(songDict);
          localStorage.setItem(savePosition, dictString);
          console.log(localStorage);
          
        })


    </script>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW"
      crossorigin="anonymous"></script>
    <!--Javascript file-->
    <script src="lastfm.js"></script>
  </body>

</html>